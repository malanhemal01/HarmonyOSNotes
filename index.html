<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>HarmonyNotes Web</title>
  <link rel="manifest" href="manifest.json" />
  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('./service-worker.js');
    }
  </script>
  <style>
    html, body { margin:0; padding:0; height:100%; overflow:hidden; }
    #canvas { background:#fdfdfd; touch-action:none; }
    #label {
      position:absolute; top:10px; left:50%;
      transform:translateX(-50%);
      font-family:sans-serif; font-size:18px;
      background:rgba(255,255,255,0.8); padding:4px 8px;
      border-radius:4px;
    }
  </style>
</head>
<body>
  <div id="label">Hello, HarmonyNotes</div>
  <canvas id="canvas"></canvas>
  <script src="https://cdn.jsdelivr.net/npm/fabric@5.3.0/dist/fabric.min.js"></script>
  <script>
    const canvas = new fabric.Canvas('canvas', {
      isDrawingMode: true,
      backgroundColor: '#fff',
      selection: false,
      fireRightClick: true,
      stopContextMenu: true,
    });
    function resize(){ canvas.setWidth(window.innerWidth); canvas.setHeight(window.innerHeight); canvas.renderAll(); }
    window.addEventListener('resize', resize); resize();
    let panning=false, last={x:0,y:0};
    canvas.on('mouse:down', o=>{ if(o.e.button===2){ panning=true; last={x:o.e.clientX,y:o.e.clientY}; }});
    canvas.on('mouse:move', o=>{ if(!panning) return; const d={x:o.e.clientX-last.x,y:o.e.clientY-last.y}; canvas.relativePan(d); last={x:o.e.clientX,y:o.e.clientY}; });
    canvas.on('mouse:up', ()=>panning=false);
    canvas.on('mouse:wheel', o=>{ let z=canvas.getZoom() * (0.999**o.e.deltaY); canvas.zoomToPoint({x:o.e.offsetX,y:o.e.offsetY}, Math.min(Math.max(z,0.2),5)); o.e.preventDefault(); });
    canvas.freeDrawingBrush=new fabric.PencilBrush(canvas);
    canvas.freeDrawingBrush.width=2;
    canvas.upperCanvasEl.addEventListener('pointermove', e=>{ if(e.pressure && e.buttons===1) canvas.freeDrawingBrush.width = 1 + e.pressure*9; });
    canvas.upperCanvasEl.addEventListener('contextmenu', e=>e.preventDefault());
  </script>
</body>
</html>
